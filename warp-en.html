<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Star Trek Warp Factor Speed Calculator</title>
<style>
  :root{ --bg:#0b1020; --panel:#0b1228; --ink:#eef2ff; --muted:#b7c1ff; --brand:#6aa8ff; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,"Segoe UI",Roboto,Helvetica,Arial;}
  .wrap{max-width:960px;margin:0 auto;padding:24px;}
  h1{margin:0 0 18px;font-size:28px;letter-spacing:.5px}
  .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:18px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .topbar{display:flex;gap:12px;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
  label{opacity:.9}
  input[type="number"]{padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0e1734;color:var(--ink);min-width:220px;font-size:16px}
  button{padding:12px 18px;border:0;border-radius:12px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
  .stage{position:relative}
  canvas{width:100%;aspect-ratio: 10/3; display:block;background:linear-gradient(180deg,#0c1430,#0a0f25)}
  .result{position:absolute;left:24px;bottom:20px;display:flex;flex-direction:column;gap:4px;pointer-events:none}
  .result .label{font-size:16px;color:var(--muted)}
  .result .value{font-size:56px;font-weight:900;line-height:1}
  .result .hint{font-size:14px;color:#ffd2d2}
  .formula{margin-top:18px;color:var(--muted);line-height:1.9}
  .formula h3{color:#d7deff;margin:14px 0 6px;font-size:16px}
  .foot{opacity:.65;font-size:12px;margin-top:8px}
</style>
<!-- MathJax -->
<script>
  window.MathJax = { tex:{ inlineMath:[['\\(','\\)']], displayMath:[['\\[','\\]']], processEscapes:true } };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
</head>
<body>

<nav style="background-color: #001f3f; padding: 10px; text-align: center;">
    <a href="index.html" style="color: white; margin: 0 15px; text-decoration: none; font-weight: bold;">Home</a>
    <a href="warp-cn.html" style="color: white; margin: 0 15px; text-decoration: none;">中文</a>
    <a href="warp-en.html" style="color: white; margin: 0 15px; text-decoration: none;">English</a>
</nav>

<div class="wrap">
  <h1>Star Trek Warp Factor Speed Calculator</h1>

  <div class="card">
    <div class="topbar">
      <label for="wInput">Warp Factor ω (1 ≤ ω ≤ 10):</label>
      <input id="wInput" type="number" step="0.0001" placeholder="e.g. 9.99" />
      <button id="calcBtn">Calculate</button>
    </div>

    <div class="stage">
      <canvas id="cv"></canvas>
      <div class="result">
        <div class="label">Speed (in multiples of c)</div>
        <div id="value" class="value">—</div>
        <div id="hint" class="hint" style="display:none"></div>
      </div>
    </div>
  </div>

  <div class="formula">
    <h3>Formula</h3>
    <div>
      \(\displaystyle s(w)=w^{\frac{10}{3}+\frac{10}{3}A(w)B(w)C(w)} \;\;(\text{unit: }c)\)<br>
      \(\displaystyle A(w)=0.20467\,e^{-0.0058\,[\log_{10}(100000-10000w)]^{5}}\)<br>
      \(\displaystyle B(w)=1+\frac{1}{3}\Bigl(2\cos\!\bigl(10\pi\,\log_{10}\!\tfrac{8}{100-10w}\bigr)-1\Bigr)\,e^{-49.369\,[\log_{10}\!\tfrac{8}{100-10w}]^{4}}\)<br>
      \(\displaystyle C(w)=1+1.88269\!\left(\frac{1}{2}-\frac{\arctan\!\bigl(10^{w}\,\log_{10}(20000-2000w)\bigr)}{\pi}\right)\)<br>
      Boundary: when \(w=10\), output “\(\infty\)”; when \(w<1\) or \(w>10\), display “Invalid input”.
    </div>
    <div class="foot">Note: Only integer-rounded results are displayed; if the result is extremely large, scientific notation will be used.</div>
  </div>
</div>

<script>
(() => {
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  const $ = id => document.getElementById(id);

  function resizeCanvas(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const cssW = cv.clientWidth;
    const cssH = cssW * 3/10;
    cv.width  = Math.round(cssW * dpr);
    cv.height = Math.round(cssH * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  new ResizeObserver(resizeCanvas).observe(cv);
  resizeCanvas();

  const shipImg = new Image();
  shipImg.src = "./Constitution_refit_side.webp";
  let shipReady = false, shipRatio = 3;
  shipImg.onload = () => { shipReady = true; shipRatio = shipImg.naturalWidth / shipImg.naturalHeight; };

  const CROP = {left: 0.00, right: 0.00, top: 0.00, bottom: 0.00};

  const log10 = x => Math.log10(x);
  function A(w){ return 0.20467 * Math.exp(-0.0058 * Math.pow(log10(100000-10000*w),5)); }
  function B(w){
    const t = log10(8/(100-10*w));
    return 1 + (1/3)*(2*Math.cos(10*Math.PI*t)-1) * Math.exp(-49.369*Math.pow(t,4));
  }
  function C(w){
    const z = Math.pow(10,w) * log10(20000-2000*w);
    return 1 + 1.88269 * (0.5 - Math.atan(z)/Math.PI);
  }
  function exponent(w){ return (10/3) * (1 + A(w)*B(w)*C(w)); }
  function compute(w){
    if (w === 10) return { kind:'inf' };
    if (!(w >= 1 && w < 10)) return { kind:'invalid', msg:'Invalid input: Please ensure 1 ≤ ω ≤ 10, and ω ≠ 10.' };
    const exp = exponent(w);
    const lnS = Math.log(w) * exp;
    if (lnS < 700){ const s = Math.exp(lnS); return { kind:'ok', rounded: Math.round(s) }; }
    const lg = lnS/Math.LN10, k = Math.floor(lg), mant = Math.pow(10, lg-k);
    return { kind:'huge', mant:mant, pow:k };
  }

  const STAR_N = 180;
  const stars = Array.from({length:STAR_N}, () => ({
    x: Math.random()*cv.clientWidth, y: Math.random()*cv.clientHeight,
    s: Math.random()*1.2 + 0.3, v: Math.random()*0.7 + 0.2
  }));
  let currentW = 1;

  function drawBackground(){
    const g = ctx.createLinearGradient(0,0,0,cv.clientHeight);
    g.addColorStop(0,'#0c1430'); g.addColorStop(1,'#0a0f25');
    ctx.fillStyle = g; ctx.fillRect(0,0,cv.clientWidth,cv.clientHeight);
  }

  function updateAndDrawStars(dt){
    const t = Math.min(Math.max((currentW-1)/9, 0), 1);
    const speedFactor = 60 * (0.15 + 1.35*t);
    for (const st of stars){
      st.x -= (st.v * speedFactor * dt);
      if (st.x < -5){ st.x = cv.clientWidth + Math.random()*40; st.y = Math.random()*cv.clientHeight; }
      ctx.globalAlpha = 0.25 + 0.55*t;
      ctx.beginPath();
      const len = (8 + 120*t) * st.v;
      ctx.moveTo(st.x, st.y);
      ctx.lineTo(st.x + len, st.y);
      ctx.lineWidth = st.s;
      ctx.strokeStyle = 'rgba(200,220,255,0.75)';
      ctx.stroke();
      ctx.globalAlpha = 0.85;
      ctx.beginPath();
      ctx.arc(st.x, st.y, st.s*0.6, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(255,255,255,.9)';
      ctx.fill();
    }
    ctx.globalAlpha = 1;
  }

  const TAIL_ANCHOR = 0.28;

  function drawShip(){
    const shipH = Math.min(cv.clientHeight * 0.28, 110);
    const natW = shipImg.naturalWidth || 1, natH = shipImg.naturalHeight || 1;
    const sx = natW * CROP.left, sy = natH * CROP.top;
    const sw = natW * (1 - CROP.left - CROP.right);
    const sh = natH * (1 - CROP.top  - CROP.bottom);
    const ratio = sw / sh;
    const shipW = shipH * ratio;

    const t = Math.min(Math.max((currentW-1)/9,0),1);
    const left = t * (cv.clientWidth - shipW);
    const y = cv.clientHeight * 0.36;

    const anchorX = left + shipW * TAIL_ANCHOR;
    const tailLen = (cv.clientWidth * 0.45) * (0.35 + 0.65*t);
    const tailW   = 14 + 10*t;

    ctx.save();
    ctx.globalCompositeOperation = 'lighter';
    let grad = ctx.createLinearGradient(anchorX - tailLen, y, anchorX, y);
    grad.addColorStop(0,'rgba(120,180,255,0)');
    grad.addColorStop(1,'rgba(140,240,220,.9)');
    ctx.strokeStyle = grad; ctx.lineWidth = tailW; ctx.lineCap = 'round';
    ctx.beginPath(); ctx.moveTo(anchorX - tailLen, y); ctx.lineTo(anchorX, y); ctx.stroke();

    let grad2 = ctx.createLinearGradient(anchorX - tailLen, y, anchorX, y);
    grad2.addColorStop(0,'rgba(80,120,255,0)');
    grad2.addColorStop(1,'rgba(220,255,255,1)');
    ctx.strokeStyle = grad2; ctx.lineWidth = Math.max(6, tailW*0.45);
    ctx.beginPath(); ctx.moveTo(anchorX - tailLen*0.92, y); ctx.lineTo(anchorX, y); ctx.stroke();
    ctx.restore();

    if (shipReady){
      ctx.drawImage(shipImg, sx, sy, sw, sh, left, y - shipH/2, shipW, shipH);
    }else{
      ctx.fillStyle = '#d7e5ff';
      ctx.fillRect(left + shipW*0.05, y-shipH*0.25, shipW*0.7, shipH*0.5);
      ctx.beginPath(); ctx.moveTo(left+shipW*0.75, y);
      ctx.lineTo(left+shipW*0.88, y-shipH*0.25);
      ctx.lineTo(left+shipW*0.88, y+shipH*0.25);
      ctx.closePath(); ctx.fill();
    }
  }

  function setResult(res){
    const value = $('value'), hint = $('hint');
    hint.style.display = 'none'; hint.textContent = '';
    if (res.kind === 'invalid'){ value.textContent = 'Invalid input'; hint.textContent = res.msg; hint.style.display = 'block'; return; }
    if (res.kind === 'inf'){ value.textContent = '∞'; return; }
    if (res.kind === 'ok'){ value.textContent = res.rounded.toLocaleString('en-US') + ' c'; return; }
    if (res.kind === 'huge'){ value.textContent = `≈ ${res.mant.toFixed(6)} × 10^${res.pow} c`; hint.textContent='Result is extremely large, shown in scientific notation'; hint.style.display='block'; return; }
  }

  let last = performance.now();
  function tick(now){
    const dt = Math.min((now - last)/1000, 0.05); last = now;
    drawBackground();
    updateAndDrawStars(dt);
    drawShip();
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  function run(){
    const v = Number($('wInput').value.trim());
    if (Number.isNaN(v)){ setResult({kind:'invalid',msg:'Please enter a number'}); return; }
    currentW = v===10 ? 10 : Math.min(Math.max(v,1),10);
    setResult(compute(v));
  }
  $('calcBtn').addEventListener('click', run);
  $('wInput').addEventListener('keydown', e => { if (e.key === 'Enter') run(); });

  currentW = 1; setResult(compute(1));
})();
</script>
</body>
</html>
